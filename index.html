<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: var(--tg-theme-bg-color, #ffffff);
            --tg-text: var(--tg-theme-text-color, #000000);
            --tg-button: var(--tg-theme-button-color, #248bcf);
            --tg-button-text: var(--tg-theme-button-text-color, #ffffff);
        }
        body { font-family: sans-serif; background: var(--tg-bg); color: var(--tg-text); margin: 0; padding: 15px; }
        
        /* Экран выбора цеха */
        #location-screen { display: flex; flex-direction: column; gap: 15px; text-align: center; padding-top: 50px; }
        .loc-btn { 
            padding: 20px; border-radius: 12px; border: 2px solid var(--tg-button); 
            background: transparent; color: var(--tg-text); font-size: 18px; font-weight: bold; cursor: pointer;
        }
        .loc-btn.active { background: var(--tg-button); color: var(--tg-button-text); }

        /* Экран салата (скрыт по умолчанию) */
        #main-app { display: none; }
        .salad-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
        .hidden { display: none; }
        
        .footer { position: fixed; bottom: 0; left: 0; width: 100%; padding: 10px; background: var(--tg-bg); border-top: 1px solid #ccc; }
        #order-btn { width: 100%; padding: 15px; border: none; border-radius: 10px; background: var(--tg-button); color: var(--tg-button-text); font-weight: bold; }
    </style>
</head>
<body>

<div id="location-screen">
    <h2 style="text-align: center;">Выберите точку:</h2>
    <button class="loc-btn" onclick="selectLocation('Эко Базар')">Эко Базар</button>
    <button class="loc-btn" onclick="selectLocation('Сергили Ярмарка')">Сергили Ярмарка</button>
    <button class="loc-btn" onclick="selectLocation('Сергили Дехкон Базар')">Сергили Дехкон Базар</button>
</div>

<div id="main-app">
    <h3 id="current-loc-title"></h3>
    <input type="text" id="search" placeholder="Поиск салата..." style="width:100%; padding:10px; margin-bottom:10px;">
    <div id="salad-list"></div>
    <div class="footer">
        <button id="order-btn">ОТПРАВИТЬ ЗАКАЗ</button>
    </div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    let selectedLocation = "";
    const saladData = {
        "Классические": ["Ашланфу", "Баклажан и дунганский перец жареный", "Баклажаны и кабачки жареные", 
  "Баклажаны маринованные", "Баклажаны соте", "Баклажаны сухие", "Винегрет", 
  "Витаминка", "Грибное ассорти", "Грибы древесные", "Грибы жареные", 
  "Грибы маринованные", "Грибы шампиньоны", "Грибы шитаки", "Капуста сладкая", 
  "Кочи нипи", "Креветки", "Лечо", "Марковча", "Марковча не крашенная", 
  "Маш", "Морская капуста", "Огурцы", "Перец жареный", "Свёкла", "Соя мясо", 
  "Спаржа", "Стрелки", "Тиби", "Тофу салат", "Фаршированный перец", "Фунчоза", 
  "Хе куриное", "Хе мясное", "Хе рыба", "Хе три буха", "Галовка капуста", 
  "Шпинат"],
        "Другие": [ "Армянский капуста", "Дайкон маринованный", "Дайкон салат", 
  "Зверобой", "Капуста кимчи", "Квашеная капуста не сладкая", 
  "Квашеная капуста сладкая", "Маринованный огурцы", "Маринованный помидор", 
  "Редиска чимчи", "Солёные ассорти", "Солёные огурцы", "Солёные памидор", 
  "Чеснок маринованный", "Чимчи", "Женский каприз", "Крабовые", "Мужской каприз", 
  "Оливье", "Чартоги", "Варенка", "Горчица", "Лозижон", "Маченка", 
  "Нори Большой", "Нори Маленький", "Пигодя крахмальные", "Пигодя рисовый", 
  "Спаржа сухая", "Халапено", "Тирой", "Борсик йог", "Гоз йог", "Цяй жареный", 
  "Уксус", "Фунчоза сухая", "Чинпени", "Чипс", "Кукси"]
    };

    function selectLocation(loc) {
        selectedLocation = loc;
        document.getElementById('location-screen').classList.add('hidden');
        document.getElementById('main-app').style.display = 'block';
        document.getElementById('current-loc-title').innerText = "Заказ для: " + loc;
    }

    // Рендер салатного списка
    const listDiv = document.getElementById('salad-list');
    salads.forEach(name => {
        listDiv.innerHTML += `
            <div class="salad-item">
                <span>${name}</span>
                <div style="display:flex; gap:5px;">
                    <input type="number" id="qty-${name}" style="width:50px" placeholder="0">
                    <select id="unit-${name}"><option>шт</option><option>кг</option></select>
                </div>
            </div>`;
    });

    document.getElementById('order-btn').onclick = function() {
        let items = [];
        salads.forEach(name => {
            let q = document.getElementById(`qty-${name}`).value;
            let u = document.getElementById(`unit-${name}`).value;
            if (q > 0) items.push({name: name, qty: q, unit: u});
        });

        if(items.length === 0) return alert("Ничего не выбрано");

        // Отправляем данные вместе с названием цеха
        tg.sendData(JSON.stringify({
            location: selectedLocation,
            order: items
        }));
    };
</script>
</body>
</html>
